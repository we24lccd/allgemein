CÃ i Ä‘áº·t Redis trÃªn Linux
A. CÃ i tá»« package (Ubuntu / Debian)
sudo apt update
sudo apt install redis-server -y

Kiá»ƒm tra:

redis-cli ping
# => PONG

B. CÃ i thá»§ cÃ´ng tá»« source (náº¿u cáº§n phiÃªn báº£n má»›i nháº¥t)
sudo apt install build-essential tcl
wget https://download.redis.io/releases/redis-7.2.5.tar.gz
tar xzf redis-7.2.5.tar.gz
cd redis-7.2.5
make
sudo make install


Cháº¡y Redis:
redis-server /etc/redis/redis.conf

ğŸ§© III. Cáº¥u hÃ¬nh Redis cÆ¡ báº£n (/etc/redis/redis.conf)
ğŸ”¸ 1. Network & Security
bind 127.0.0.1 ::1        # Chá»‰ cho phÃ©p localhost (khÃ´ng má»Ÿ public)
protected-mode yes
port 6379


â¡ Náº¿u cáº§n truy cáº­p tá»« xa (chá»‰ trong máº¡ng ná»™i bá»™):
bind 0.0.0.0
requirepass MyStrongPassword123

ğŸ”¸ 2. Persistence (LÆ°u dá»¯ liá»‡u ra Ä‘Ä©a)

Redis cÃ³ 2 cÆ¡ cháº¿:

CÆ¡ cháº¿	File	Äáº·c Ä‘iá»ƒm
RDB (snapshot)	dump.rdb	Backup Ä‘á»‹nh ká»³, nhanh
AOF (Append Only File)	appendonly.aof	Ghi log má»i thay Ä‘á»•i, an toÃ n hÆ¡n nhÆ°ng cháº­m hÆ¡n

Báº­t AOF:
appendonly yes
appendfsync everysec

ğŸ”¸ 3. Memory Management
maxmemory 2gb
maxmemory-policy allkeys-lru   # XÃ³a key Ã­t dÃ¹ng khi Ä‘áº§y RAM


ChÃ­nh sÃ¡ch memory:
noeviction: lá»—i khi háº¿t RAM
volatile-lru: xÃ³a key cÃ³ TTL cÅ©
allkeys-lru: xÃ³a key Ã­t dÃ¹ng nháº¥t
volatile-ttl: xÃ³a key sáº¯p háº¿t háº¡n

ğŸ”¸ 4. Logging
logfile /var/log/redis/redis-server.log
loglevel notice

ğŸ”¸ 5. Systemd service

Enable vÃ  start Redis tá»± Ä‘á»™ng:
sudo systemctl enable redis-server
sudo systemctl start redis-server
sudo systemctl status redis-server

ğŸ§  IV. CÃ¡c lá»‡nh cÆ¡ báº£n Redis CLI
Lá»‡nh	MÃ´ táº£
redis-cli ping	Kiá»ƒm tra káº¿t ná»‘i
SET key value	GÃ¡n giÃ¡ trá»‹
GET key	Láº¥y giÃ¡ trá»‹
DEL key	XÃ³a key
KEYS *	Liá»‡t kÃª táº¥t cáº£ key
INFO memory	Xem RAM dÃ¹ng
MONITOR	Xem live command log
FLUSHALL	XÃ³a toÃ n bá»™ database
CONFIG GET *	Xem cáº¥u hÃ¬nh hiá»‡n táº¡i
ğŸ§° V. Backup & Restore
Backup (tá»± Ä‘á»™ng khi snapshot RDB)

File backup máº·c Ä‘á»‹nh:
/var/lib/redis/dump.rdb


Táº¡o backup thá»§ cÃ´ng:
redis-cli SAVE
cp /var/lib/redis/dump.rdb /backup/redis_$(date +%F).rdb

Restore:
Stop Redis

Copy file dump.rdb vÃ o /var/lib/redis/
Start láº¡i Redis

Redis sáº½ tá»± load data tá»« file Ä‘Ã³

ğŸ” VI. Redis Replication & Sentinel (High Availability)
A. Replication

Redis há»— trá»£ mÃ´ hÃ¬nh Master â€“ Replica
TrÃªn replica node:

replicaof 192.168.10.10 6379
masterauth MyStrongPassword123

Kiá»ƒm tra:
redis-cli INFO replication

B. Redis Sentinel (Failover tá»± Ä‘á»™ng)
Quáº£n lÃ½ nhiá»u Redis node, giÃ¡m sÃ¡t Master/Replica
File cáº¥u hÃ¬nh /etc/redis/sentinel.conf:

port 26379
sentinel monitor mymaster 192.168.10.10 6379 2
sentinel auth-pass mymaster MyStrongPassword123
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 10000


Start:
redis-sentinel /etc/redis/sentinel.conf

âš¡ VII. Monitoring Redis
A. DÃ¹ng CLI:
redis-cli INFO stats
redis-cli INFO memory
redis-cli INFO clients

B. Exporter cho Prometheus:

CÃ i redis_exporter:

wget https://github.com/oliver006/redis_exporter/releases/download/v1.55.0/redis_exporter-v1.55.0.linux-amd64.tar.gz
tar -xzf redis_exporter*.tar.gz
./redis_exporter --redis.addr=redis://localhost:6379


â†’ DÃ¹ng Grafana import dashboard â€œRedis Overviewâ€.

ğŸ§© VIII. Troubleshooting Redis
Váº¥n Ä‘á»	NguyÃªn nhÃ¢n	HÆ°á»›ng xá»­ lÃ½
KhÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c Redis tá»« client	bind 127.0.0.1 hoáº·c protected-mode yes	Chá»‰nh bind 0.0.0.0, má»Ÿ port 6379
Connection Refused	Redis chÆ°a start	systemctl status redis-server
Password sai (NOAUTH)	Thiáº¿u requirepass hoáº·c sai password	Kiá»ƒm tra redis.conf vÃ  reconnect
Out of memory	maxmemory nhá» hoáº·c policy noeviction	TÄƒng RAM hoáº·c dÃ¹ng allkeys-lru
Disk full khi báº­t AOF	File appendonly.aof quÃ¡ lá»›n	DÃ¹ng BGREWRITEAOF hoáº·c disable táº¡m
Master â€“ Replica sync fail	Network delay hoáº·c auth fail	Kiá»ƒm tra replicaof vÃ  masterauth
High latency	Swapping hoáº·c network slow	DÃ¹ng INFO latency, tÃ¡ch cache khá»i disk IO
Redis crash loop	dump.rdb corrupt	XÃ³a dump.rdb vÃ  restore tá»« backup
CPU 100%	Keyspace lá»›n, scan hoáº·c MONITOR	TrÃ¡nh dÃ¹ng KEYS *, dÃ¹ng SCAN thay tháº¿
ğŸ’¡ IX. Redis trong mÃ´i trÆ°á»ng Production

âœ… Checklist System Engineer:
 maxmemory & eviction policy rÃµ rÃ ng
 DÃ¹ng AOF hoáº·c RDB snapshot backup Ä‘á»‹nh ká»³
 Masterâ€“Replica + Sentinel failover
 Monitoring Prometheus + Grafana
 Limit client connections (maxclients)
 DÃ¹ng rename-command Ä‘á»ƒ áº©n lá»‡nh nguy hiá»ƒm (FLUSHALL, CONFIG)
 Báº£o máº­t: requirepass, firewall, VPN ná»™i bá»™
 Tune kernel: vm.overcommit_memory=1, tcp-backlog, somaxconn

I. ğŸ§  Tá»•ng quan
ThÃ nh pháº§n	MÃ´ táº£
Redis Server	Database in-memory key-value, tá»‘c Ä‘á»™ cá»±c nhanh
Redis Sentinel	Theo dÃµi master/slave, tá»± Ä‘á»™ng failover
Redis Cluster	PhÃ¢n máº£nh dá»¯ liá»‡u (sharding) Ä‘á»ƒ scale horizontally
Redis Replication	Äá»“ng bá»™ dá»¯ liá»‡u masterâ€“slave
Persistence	RDB (snapshot) & AOF (append-only file)
Use Cases	Cache, Session Store, Pub/Sub, Queue, Rate Limiting
II. âš™ï¸ 1ï¸âƒ£ CÃ€I Äáº¶T & Cáº¤U HÃŒNH
A. CÃ i Ä‘áº·t Redis trÃªn Linux (Ubuntu)
sudo apt update && sudo apt install redis-server -y

B. Cáº¥u hÃ¬nh cÆ¡ báº£n /etc/redis/redis.conf
bind 0.0.0.0
protected-mode yes
port 6379
requirepass StrongRedisPassword123
maxmemory 1gb
maxmemory-policy allkeys-lru
appendonly yes
appendfilename "appendonly.aof"
save 900 1
save 300 10
save 60 10000
logfile /var/log/redis/redis-server.log


âœ… Giáº£i thÃ­ch nhanh:

maxmemory-policy allkeys-lru: dÃ¹ng LRU eviction khi Ä‘áº§y RAM

appendonly yes: báº­t AOF (an toÃ n hÆ¡n RDB snapshot)

save: báº­t snapshot backup (RDB)

C. Khá»Ÿi Ä‘á»™ng & kiá»ƒm tra
sudo systemctl enable redis-server
sudo systemctl start redis-server
redis-cli -a StrongRedisPassword123 ping
# Output: PONG

III. ğŸ” 2ï¸âƒ£ REPLICATION & SENTINEL (HA)
A. Master / Slave cáº¥u hÃ¬nh

TrÃªn Slave server:

replicaof <MASTER_IP> 6379
masterauth StrongRedisPassword123


Kiá»ƒm tra tráº¡ng thÃ¡i:

redis-cli -a StrongRedisPassword123 info replication


Output máº«u:

role:slave
master_link_status:up

B. Redis Sentinel Setup

TrÃªn má»—i node (Ã­t nháº¥t 3 Sentinel):

sudo apt install redis-sentinel -y
cp /etc/redis/sentinel.conf /etc/redis/sentinel-6379.conf


Cáº¥u hÃ¬nh /etc/redis/sentinel-6379.conf:

port 26379
sentinel monitor mymaster 10.0.0.11 6379 2
sentinel auth-pass mymaster StrongRedisPassword123
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 10000


Khá»Ÿi Ä‘á»™ng Sentinel:

redis-sentinel /etc/redis/sentinel-6379.conf --daemonize yes


Kiá»ƒm tra:

redis-cli -p 26379 sentinel masters
redis-cli -p 26379 sentinel slaves mymaster


âœ… Sentinel quorum yÃªu cáº§u â‰¥ 2 node Ä‘á»“ng thuáº­n Ä‘á»ƒ báº§u leader má»›i.

IV. ğŸ§© 3ï¸âƒ£ REDIS CLUSTER (SCALING)
A. Chuáº©n bá»‹ node

6 node (3 master + 3 slave):

10.0.0.11:6379
10.0.0.12:6379
10.0.0.13:6379
10.0.0.14:6379
10.0.0.15:6379
10.0.0.16:6379


Táº¡o cluster:

redis-cli --cluster create \
10.0.0.11:6379 10.0.0.12:6379 10.0.0.13:6379 \
10.0.0.14:6379 10.0.0.15:6379 10.0.0.16:6379 \
--cluster-replicas 1


Kiá»ƒm tra:

redis-cli -c -h 10.0.0.11 cluster info
redis-cli -c cluster nodes

V. ğŸ’¾ 4ï¸âƒ£ BACKUP & RESTORE
A. RDB Snapshot
redis-cli SAVE
# hoáº·c async
redis-cli BGSAVE


File náº±m táº¡i /var/lib/redis/dump.rdb

B. AOF Backup
cp /var/lib/redis/appendonly.aof /backup/redis-aof-$(date +%F).aof

C. Restore

Dá»«ng Redis
sudo systemctl stop redis-server

Copy file dump.rdb hoáº·c appendonly.aof vÃ o /var/lib/redis/

Khá»Ÿi Ä‘á»™ng láº¡i Redis
sudo systemctl start redis-server

VI. ğŸ”’ 5ï¸âƒ£ SECURITY BEST PRACTICES
Biá»‡n phÃ¡p	MÃ´ táº£
requirepass	Äáº·t máº­t kháº©u máº¡nh
bind 127.0.0.1 hoáº·c VPN	Giá»›i háº¡n IP truy cáº­p
TLS	DÃ¹ng stunnel hoáº·c Redis 6+ TLS
ACL	PhÃ¢n quyá»n theo user (acl setuser readonly on +get ~cached:*)
Disable dangerous commands	rename-command CONFIG ""
VII. ğŸ“Š 6ï¸âƒ£ MONITORING (PROMETHEUS / ZABBIX)
A. Redis Exporter (Prometheus)
docker run -d -p 9121:9121 oliver006/redis_exporter \
  --redis.addr=redis://10.0.0.11:6379 \
  --redis.password=StrongRedisPassword123


Metric quan trá»ng:

redis_connected_clients

redis_used_memory

redis_keyspace_hits

redis_keyspace_misses

redis_commands_processed_total

Dashboard: Grafana â†’ Import â†’ ID 763

B. Zabbix Monitoring

Template: Template DB Redis by Zabbix agent

Items:

redis.uptime

redis.memory.used

redis.clients.connected

redis.replication.role

redis.info[role]

Trigger máº«u:

{Template DB Redis:redis.memory.used.last()}>800000000


â†’ Cáº£nh bÃ¡o khi Redis dÃ¹ng >800MB RAM.

VIII. ğŸ”§ 7ï¸âƒ£ TROUBLESHOOTING
Váº¥n Ä‘á»	NguyÃªn nhÃ¢n	CÃ¡ch xá»­ lÃ½
MISCONF khi ghi dá»¯ liá»‡u	Redis á»Ÿ cháº¿ Ä‘á»™ read-only	Kiá»ƒm tra replication role, Ä‘á»•i sang master
Dá»¯ liá»‡u máº¥t sau reboot	ChÆ°a báº­t AOF / save	Báº­t appendonly yes vÃ  save trong config
Slave khÃ´ng sync	network issue / auth sai	Xem info replication, kiá»ƒm tra firewall vÃ  password
â€œOOM command not allowedâ€	Háº¿t RAM	TÄƒng maxmemory, Ä‘á»•i policy volatile-lru
Sentinel failover khÃ´ng diá»…n ra	quorum < 2 hoáº·c auth lá»—i	Xem sentinel info, kiá»ƒm tra auth-pass
IX. ğŸ§  8ï¸âƒ£ BEST PRACTICES PROD

âœ… DÃ¹ng Redis Cluster hoáº·c Sentinel Ä‘á»ƒ HA
âœ… DÃ¹ng AOF + snapshot song song
âœ… Theo dÃµi memory fragmentation ratio
âœ… Backup Ä‘á»‹nh ká»³ báº±ng cron:

0 2 * * * redis-cli BGSAVE && cp /var/lib/redis/dump.rdb /backup/


âœ… Äáº·t vm.overcommit_memory=1
âœ… Sá»­ dá»¥ng TLS cho Redis >= 6
