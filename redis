CÃ i Ä‘áº·t Redis trÃªn Linux
A. CÃ i tá»« package (Ubuntu / Debian)
sudo apt update
sudo apt install redis-server -y

Kiá»ƒm tra:

redis-cli ping
# => PONG

B. CÃ i thá»§ cÃ´ng tá»« source (náº¿u cáº§n phiÃªn báº£n má»›i nháº¥t)
sudo apt install build-essential tcl
wget https://download.redis.io/releases/redis-7.2.5.tar.gz
tar xzf redis-7.2.5.tar.gz
cd redis-7.2.5
make
sudo make install


Cháº¡y Redis:
redis-server /etc/redis/redis.conf

ğŸ§© III. Cáº¥u hÃ¬nh Redis cÆ¡ báº£n (/etc/redis/redis.conf)
ğŸ”¸ 1. Network & Security
bind 127.0.0.1 ::1        # Chá»‰ cho phÃ©p localhost (khÃ´ng má»Ÿ public)
protected-mode yes
port 6379


â¡ Náº¿u cáº§n truy cáº­p tá»« xa (chá»‰ trong máº¡ng ná»™i bá»™):
bind 0.0.0.0
requirepass MyStrongPassword123

ğŸ”¸ 2. Persistence (LÆ°u dá»¯ liá»‡u ra Ä‘Ä©a)

Redis cÃ³ 2 cÆ¡ cháº¿:

CÆ¡ cháº¿	File	Äáº·c Ä‘iá»ƒm
RDB (snapshot)	dump.rdb	Backup Ä‘á»‹nh ká»³, nhanh
AOF (Append Only File)	appendonly.aof	Ghi log má»i thay Ä‘á»•i, an toÃ n hÆ¡n nhÆ°ng cháº­m hÆ¡n

Báº­t AOF:
appendonly yes
appendfsync everysec

ğŸ”¸ 3. Memory Management
maxmemory 2gb
maxmemory-policy allkeys-lru   # XÃ³a key Ã­t dÃ¹ng khi Ä‘áº§y RAM


ChÃ­nh sÃ¡ch memory:
noeviction: lá»—i khi háº¿t RAM
volatile-lru: xÃ³a key cÃ³ TTL cÅ©
allkeys-lru: xÃ³a key Ã­t dÃ¹ng nháº¥t
volatile-ttl: xÃ³a key sáº¯p háº¿t háº¡n

ğŸ”¸ 4. Logging
logfile /var/log/redis/redis-server.log
loglevel notice

ğŸ”¸ 5. Systemd service

Enable vÃ  start Redis tá»± Ä‘á»™ng:
sudo systemctl enable redis-server
sudo systemctl start redis-server
sudo systemctl status redis-server

ğŸ§  IV. CÃ¡c lá»‡nh cÆ¡ báº£n Redis CLI
Lá»‡nh	MÃ´ táº£
redis-cli ping	Kiá»ƒm tra káº¿t ná»‘i
SET key value	GÃ¡n giÃ¡ trá»‹
GET key	Láº¥y giÃ¡ trá»‹
DEL key	XÃ³a key
KEYS *	Liá»‡t kÃª táº¥t cáº£ key
INFO memory	Xem RAM dÃ¹ng
MONITOR	Xem live command log
FLUSHALL	XÃ³a toÃ n bá»™ database
CONFIG GET *	Xem cáº¥u hÃ¬nh hiá»‡n táº¡i
ğŸ§° V. Backup & Restore
Backup (tá»± Ä‘á»™ng khi snapshot RDB)

File backup máº·c Ä‘á»‹nh:
/var/lib/redis/dump.rdb


Táº¡o backup thá»§ cÃ´ng:
redis-cli SAVE
cp /var/lib/redis/dump.rdb /backup/redis_$(date +%F).rdb

Restore:
Stop Redis

Copy file dump.rdb vÃ o /var/lib/redis/
Start láº¡i Redis

Redis sáº½ tá»± load data tá»« file Ä‘Ã³

ğŸ” VI. Redis Replication & Sentinel (High Availability)
A. Replication

Redis há»— trá»£ mÃ´ hÃ¬nh Master â€“ Replica
TrÃªn replica node:

replicaof 192.168.10.10 6379
masterauth MyStrongPassword123

Kiá»ƒm tra:
redis-cli INFO replication

B. Redis Sentinel (Failover tá»± Ä‘á»™ng)
Quáº£n lÃ½ nhiá»u Redis node, giÃ¡m sÃ¡t Master/Replica
File cáº¥u hÃ¬nh /etc/redis/sentinel.conf:

port 26379
sentinel monitor mymaster 192.168.10.10 6379 2
sentinel auth-pass mymaster MyStrongPassword123
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 10000


Start:
redis-sentinel /etc/redis/sentinel.conf

âš¡ VII. Monitoring Redis
A. DÃ¹ng CLI:
redis-cli INFO stats
redis-cli INFO memory
redis-cli INFO clients

B. Exporter cho Prometheus:

CÃ i redis_exporter:

wget https://github.com/oliver006/redis_exporter/releases/download/v1.55.0/redis_exporter-v1.55.0.linux-amd64.tar.gz
tar -xzf redis_exporter*.tar.gz
./redis_exporter --redis.addr=redis://localhost:6379


â†’ DÃ¹ng Grafana import dashboard â€œRedis Overviewâ€.

ğŸ§© VIII. Troubleshooting Redis
Váº¥n Ä‘á»	NguyÃªn nhÃ¢n	HÆ°á»›ng xá»­ lÃ½
KhÃ´ng káº¿t ná»‘i Ä‘Æ°á»£c Redis tá»« client	bind 127.0.0.1 hoáº·c protected-mode yes	Chá»‰nh bind 0.0.0.0, má»Ÿ port 6379
Connection Refused	Redis chÆ°a start	systemctl status redis-server
Password sai (NOAUTH)	Thiáº¿u requirepass hoáº·c sai password	Kiá»ƒm tra redis.conf vÃ  reconnect
Out of memory	maxmemory nhá» hoáº·c policy noeviction	TÄƒng RAM hoáº·c dÃ¹ng allkeys-lru
Disk full khi báº­t AOF	File appendonly.aof quÃ¡ lá»›n	DÃ¹ng BGREWRITEAOF hoáº·c disable táº¡m
Master â€“ Replica sync fail	Network delay hoáº·c auth fail	Kiá»ƒm tra replicaof vÃ  masterauth
High latency	Swapping hoáº·c network slow	DÃ¹ng INFO latency, tÃ¡ch cache khá»i disk IO
Redis crash loop	dump.rdb corrupt	XÃ³a dump.rdb vÃ  restore tá»« backup
CPU 100%	Keyspace lá»›n, scan hoáº·c MONITOR	TrÃ¡nh dÃ¹ng KEYS *, dÃ¹ng SCAN thay tháº¿
ğŸ’¡ IX. Redis trong mÃ´i trÆ°á»ng Production

âœ… Checklist System Engineer:
 maxmemory & eviction policy rÃµ rÃ ng
 DÃ¹ng AOF hoáº·c RDB snapshot backup Ä‘á»‹nh ká»³
 Masterâ€“Replica + Sentinel failover
 Monitoring Prometheus + Grafana
 Limit client connections (maxclients)
 DÃ¹ng rename-command Ä‘á»ƒ áº©n lá»‡nh nguy hiá»ƒm (FLUSHALL, CONFIG)
 Báº£o máº­t: requirepass, firewall, VPN ná»™i bá»™
 Tune kernel: vm.overcommit_memory=1, tcp-backlog, somaxconn
