3. Táº¡o chá»©ng chá»‰ SSL báº±ng OpenSSL
3.1. Sinh private key
cd C:\OpenSSL-Win64\bin

openssl genpkey -algorithm RSA -out C:\Apache24\conf\ssl\server.key -pkeyopt rsa_keygen_bits:2048

3.2. Táº¡o CSR
openssl req -new -key C:\Apache24\conf\ssl\server.key -out C:\Apache24\conf\ssl\server.csr

ğŸ‘‰ Nháº­p thÃ´ng tin, chÃº Ã½:

Common Name (CN) = hostname hoáº·c IP server (vd: lab.local hay 192.168.1.100).

3.3. Táº¡o Self-signed Certificate
openssl x509 -req -days 365 -in C:\Apache24\conf\ssl\server.csr -signkey C:\Apache24\conf\ssl\server.key -out C:\Apache24\conf\ssl\server.crt

ğŸ‘‰ Giá» cÃ³:

server.key
server.crt

4. Cáº¥u hÃ¬nh Apache vá»›i SSL
4.1. Má»Ÿ file cáº¥u hÃ¬nh

Má»Ÿ C:\Apache24\conf\httpd.conf báº±ng Notepad.

Bá» comment 2 dÃ²ng sau (xÃ³a dáº¥u #):

LoadModule ssl_module modules/mod_ssl.so
Include conf/extra/httpd-ssl.conf

4.2. Sá»­a file SSL config

Má»Ÿ C:\Apache24\conf\extra\httpd-ssl.conf.
TÃ¬m vÃ  sá»­a cÃ¡c dÃ²ng sau:

<VirtualHost _default_:443>
    DocumentRoot "C:/Apache24/htdocs"
    ServerName lab.local:443

    SSLEngine on
    SSLCertificateFile "C:/Apache24/conf/ssl/server.crt"
    SSLCertificateKeyFile "C:/Apache24/conf/ssl/server.key"
</VirtualHost>

ğŸ‘‰ LÆ°u Ã½: Windows dÃ¹ng / thay cho \ trong Ä‘Æ°á»ng dáº«n.

5. Khá»Ÿi Ä‘á»™ng Apache
Trong cmd (Administrator):

cd C:\Apache24\bin
httpd -k install
httpd -k start

Náº¿u muá»‘n restart:
httpd -k restart

6. Kiá»ƒm tra káº¿t quáº£

Má»Ÿ trÃ¬nh duyá»‡t trÃªn server hoáº·c client:
https://lab.local/
hoáº·c
https://<IP-server>/

ğŸ‘‰ TrÃ¬nh duyá»‡t sáº½ bÃ¡o certificate not trusted (vÃ¬ self-signed). Bá» qua lÃ  vÃ o Ä‘Æ°á»£c.


- Apache load balancing
ğŸ”¹ 1. CÃ¡c phÆ°Æ¡ng phÃ¡p phÃ¢n phá»‘i (Load Balancing Methods)

Khi khai bÃ¡o ProxyPass vá»›i balancer, báº¡n cÃ³ thá»ƒ chá»n thuáº­t toÃ¡n:

<Proxy "balancer://flaskcluster">
    BalancerMember http://127.0.0.1:5000
    BalancerMember http://127.0.0.1:5001
    ProxySet lbmethod=byrequests
</Proxy>

CÃ¡c lbmethod cÃ³ sáºµn:

byrequests (default) â†’ Round-robin, chia Ä‘á»u theo sá»‘ request.

bytraffic â†’ Chia theo dung lÆ°á»£ng bÄƒng thÃ´ng (ai Ã­t data thÃ¬ nháº­n thÃªm).

bybusyness â†’ Chia theo sá»‘ káº¿t ná»‘i Ä‘ang báº­n (server nÃ o nhÃ n thÃ¬ Ä‘Æ°á»£c nháº­n).

heartbeat â†’ PhÃ¹ há»£p vá»›i cluster cÃ³ health-check nÃ¢ng cao.

ğŸ‘‰ Báº¡n cÃ³ thá»ƒ Ä‘á»•i cÃ¡ch phÃ¢n phá»‘i ngay trong httpd-balancer.conf.

ğŸ”¹ 2. GÃ¡n trá»ng sá»‘ (Load Balancing Factor)

CÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a server nÃ o máº¡nh thÃ¬ nháº­n nhiá»u request hÆ¡n:

<Proxy "balancer://flaskcluster">
    BalancerMember http://127.0.0.1:5000 loadfactor=1
    BalancerMember http://127.0.0.1:5001 loadfactor=3
    ProxySet lbmethod=byrequests
</Proxy>

â†’ Káº¿t quáº£: port 5001 nháº­n khoáº£ng 75% request, port 5000 chá»‰ nháº­n 25%.

ğŸ”¹ 3. Quáº£n lÃ½ qua Balancer Manager

Truy cáº­p:
ğŸ‘‰ http://localhost:8080/balancer-manager

Táº¡i Ä‘Ã¢y cÃ³ thá»ƒ:

Disable/Enable má»™t backend táº¡m thá»i.
Thay Ä‘á»•i loadfactor (trá»ng sá»‘) ngay táº¡i runtime.
Check tráº¡ng thÃ¡i worker (Init Ok, Error, Busyâ€¦).
NhÆ°ng: cáº¥u hÃ¬nh nÃ y khÃ´ng Ä‘Æ°á»£c lÆ°u sau khi restart â†’ chá»‰ runtime.

ğŸ”¹ 4. Health check (kiá»ƒm tra backend sá»‘ng/cháº¿t)

Apache cÃ³ module mod_proxy_hcheck (náº¿u báº­t) Ä‘á»ƒ tá»± Ä‘á»™ng check backend.
VÃ­ dá»¥ cáº¥u hÃ¬nh health check Ä‘Æ¡n giáº£n:

<Proxy "balancer://flaskcluster">
    BalancerMember http://127.0.0.1:5000 hcmethod=GET hcuri=/ hcexpr=%{REQUEST_STATUS} == 200
    BalancerMember http://127.0.0.1:5001 hcmethod=GET hcuri=/ hcexpr=%{REQUEST_STATUS} == 200
    ProxySet lbmethod=byrequests
</Proxy>


ğŸ‘‰ Náº¿u backend tráº£ lá»—i (khÃ´ng pháº£i HTTP 200) thÃ¬ Apache sáº½ tá»± loáº¡i bá» nÃ³ khá»i cluster.

ğŸ”¹ 5. Sticky Session (giá»¯ session vá» 1 backend)

DÃ¹ng khi backend cÃ³ session theo user (vÃ­ dá»¥ login):

<Proxy "balancer://flaskcluster">
    BalancerMember http://127.0.0.1:5000 route=flask1
    BalancerMember http://127.0.0.1:5001 route=flask2
    ProxySet stickysession=JSESSIONID|jsessionid
</Proxy>

ğŸ‘‰ Náº¿u client cÃ³ cookie JSESSIONID=flask1, request sáº½ luÃ´n vá» backend 5000.

ğŸ”¹ 6. Failover (dá»± phÃ²ng)

CÃ³ thá»ƒ Ä‘Ã¡nh dáº¥u 1 backend lÃ  standby, chá»‰ cháº¡y khi server chÃ­nh cháº¿t:

<Proxy "balancer://flaskcluster">
    BalancerMember http://127.0.0.1:5000
    BalancerMember http://127.0.0.1:5001 status=+H
</Proxy>

status=+H â†’ backend á»Ÿ cháº¿ Ä‘á»™ Hot Standby.
â†’ BÃ¬nh thÆ°á»ng chá»‰ 5000 nháº­n request, khi 5000 down thÃ¬ 5001 má»›i cháº¡y.

ğŸ”¹ 7. Giá»›i háº¡n sá»‘ káº¿t ná»‘i / timeout

CÃ³ thá»ƒ cáº¥u hÃ¬nh giá»›i háº¡n:

<Proxy "balancer://flaskcluster">
    BalancerMember http://127.0.0.1:5000 max=50 retry=30
    BalancerMember http://127.0.0.1:5001 max=50 retry=30
</Proxy>

max=50 â†’ tá»‘i Ä‘a 50 káº¿t ná»‘i Ä‘á»“ng thá»i.
retry=30 â†’ sau 30s thá»­ káº¿t ná»‘i láº¡i backend náº¿u nÃ³ tá»«ng fail.

âœ… Tá»•ng káº¿t

Apache load balancer trong httpd.conf cÃ³ thá»ƒ:
Chia táº£i (round robin, traffic, busyness).
GÃ¡n trá»ng sá»‘ (server máº¡nh xá»­ lÃ½ nhiá»u hÆ¡n).
Failover khi server chÃ­nh cháº¿t.
Sticky session (giá»¯ user trÃªn cÃ¹ng backend).
Health-check backend.
Quáº£n lÃ½ runtime qua /balancer-manager.


ğŸ”¹ BÆ°á»›c 1: Stop vÃ  disable Apache24 standalone

Apache24 hiá»‡n cháº¡y á»Ÿ C:\Apache24 â†’ stop service nÃ y Ä‘á»ƒ nÃ³ khÃ´ng tranh cá»•ng.

Má»Ÿ PowerShell (Admin):

# TÃ¬m xem cÃ³ service Apache24 khÃ´ng
Get-Service *Apache*

# Stop service Apache24 náº¿u Ä‘ang cháº¡y
Stop-Service Apache2.4 -Force

# Disable Ä‘á»ƒ khÃ´ng tá»± khá»Ÿi Ä‘á»™ng láº¡i
Set-Service Apache2.4 -StartupType Disabled


ğŸ‘‰ Sau bÆ°á»›c nÃ y, Apache standalone sáº½ khÃ´ng chiáº¿m port ná»¯a.

ğŸ”¹ BÆ°á»›c 2: Táº¯t IIS (World Wide Web Publishing Service)

IIS cÅ©ng thÆ°á»ng chiáº¿m port 80.

Stop-Service W3SVC -Force
Set-Service W3SVC -StartupType Disabled
Stop-Service WAS -Force
Set-Service WAS -StartupType Disabled


ğŸ‘‰ Port 80 sáº½ Ä‘Æ°á»£c giáº£i phÃ³ng hoÃ n toÃ n cho XAMPP.
