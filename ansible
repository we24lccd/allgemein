2. CÃ i Ä‘áº·t Ansible
ğŸ§ TrÃªn Ubuntu/Debian
sudo apt update
sudo apt install -y ansible python3-pip
ansible --version

ğŸ§ TrÃªn RHEL/CentOS
sudo yum install epel-release -y
sudo yum install ansible -y

ğŸ Tá»« pip (phiÃªn báº£n má»›i nháº¥t)
pip install ansible

ğŸ§© Kiá»ƒm tra
ansible --version
ansible all -i localhost, -m ping

ğŸ—ï¸ 3. Cáº¥u trÃºc thÆ° má»¥c chuáº©n (Best Practice)
ansible-project/
â”œâ”€â”€ ansible.cfg
â”œâ”€â”€ inventory/
â”‚   â”œâ”€â”€ hosts.ini
â”‚   â””â”€â”€ group_vars/
â”‚       â”œâ”€â”€ web.yml
â”‚       â”œâ”€â”€ db.yml
â”œâ”€â”€ roles/
â”‚   â”œâ”€â”€ nginx/
â”‚   â”‚   â”œâ”€â”€ tasks/main.yml
â”‚   â”‚   â”œâ”€â”€ templates/nginx.conf.j2
â”‚   â”‚   â””â”€â”€ handlers/main.yml
â”œâ”€â”€ playbooks/
â”‚   â”œâ”€â”€ site.yml
â”‚   â””â”€â”€ deploy.yml
â””â”€â”€ files/
    â””â”€â”€ ssl.key

ğŸ§­ 4. Cáº¥u hÃ¬nh cÆ¡ báº£n
ğŸ”¹ ansible.cfg
[defaults]
inventory = ./inventory/hosts.ini
remote_user = devops
host_key_checking = False
timeout = 30
log_path = ./ansible.log

ğŸ”¹ inventory/hosts.ini
[web]
192.168.1.10
192.168.1.11

[db]
192.168.1.20

[all:vars]
ansible_user=ubuntu
ansible_ssh_private_key_file=~/.ssh/id_rsa

ğŸ”¹ Ping kiá»ƒm tra káº¿t ná»‘i
ansible all -m ping

ğŸ§± 5. Playbook cÆ¡ báº£n
VÃ­ dá»¥: CÃ i Ä‘áº·t Nginx
---
- name: Install and start Nginx
  hosts: web
  become: yes
  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present
        update_cache: yes

    - name: Start and enable Nginx
      service:
        name: nginx
        state: started
        enabled: yes


Cháº¡y playbook:

ansible-playbook playbooks/nginx.yml

ğŸ§© 6. Roles vÃ  Reusability
VÃ­ dá»¥: Role â€œnginxâ€

tasks/main.yml

- include_tasks: install.yml
- include_tasks: config.yml
- include_tasks: service.yml


templates/nginx.conf.j2

server {
  listen 80;
  server_name {{ inventory_hostname }};
  root /var/www/html;
}


handlers/main.yml

- name: restart nginx
  service:
    name: nginx
    state: restarted


Gá»i role:

- hosts: web
  roles:
    - nginx

ğŸ”’ 7. Quáº£n lÃ½ Secrets vá»›i Ansible Vault

Táº¡o file bÃ­ máº­t:

ansible-vault create secrets.yml


Giáº£i mÃ£ táº¡m thá»i:
ansible-vault view secrets.yml
ansible-vault edit secrets.yml


Sá»­ dá»¥ng trong playbook:
vars_files:
  - secrets.yml


Cháº¡y playbook cÃ³ mÃ£ hÃ³a:
ansible-playbook playbooks/deploy.yml --ask-vault-pass

ğŸ› ï¸ 8. Troubleshooting â€“ CÃ¡c lá»—i phá»• biáº¿n
âŒ Lá»—i SSH Permission Denied

NguyÃªn nhÃ¢n:

Key SSH sai / user khÃ´ng cÃ³ quyá»n sudo
Giáº£i phÃ¡p:

Kiá»ƒm tra ansible_user vÃ  key path trong inventory

Cháº¡y: ssh -i ~/.ssh/id_rsa user@host Ä‘á»ƒ xÃ¡c minh

âŒ â€œFailed to lock aptâ€ hoáº·c â€œYum lockâ€

NguyÃªn nhÃ¢n: cÃ³ process khÃ¡c Ä‘ang cháº¡y apt/yum
Giáº£i phÃ¡p:
sudo rm /var/lib/apt/lists/lock
sudo rm /var/lib/dpkg/lock*
sudo dpkg --configure -a

âŒ â€œUNREACHABLE! Host unreachableâ€

NguyÃªn nhÃ¢n: firewall hoáº·c host key checking
Giáº£i phÃ¡p:

ThÃªm vÃ o ansible.cfg:
host_key_checking = False

Má»Ÿ port SSH (22/tcp)

âŒ Template khÃ´ng render biáº¿n

NguyÃªn nhÃ¢n: sai cÃº phÃ¡p Jinja2 hoáº·c chÆ°a khai bÃ¡o biáº¿n
Giáº£i phÃ¡p:
Kiá»ƒm tra:
ansible-playbook playbook.yml --check --diff -vvv

âŒ Vault password khÃ´ng khá»›p

Giáº£i phÃ¡p:

Sá»­ dá»¥ng --ask-vault-pass hoáº·c táº¡o vault ID file riÃªng:
ansible-playbook site.yml --vault-id dev@~/.vault_pass.txt

ğŸ“Š 9. GiÃ¡m sÃ¡t & Logging

Báº­t log trong ansible.cfg

[defaults]
log_path = /var/log/ansible.log


DÃ¹ng -v, -vv, -vvv Ä‘á»ƒ debug chi tiáº¿t:

ansible-playbook deploy.yml -vvv
