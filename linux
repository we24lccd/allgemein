$USER tên người sử dụng hiện tại
echo in ra màn hình
read đọc từ bàn phím
$HOME/$home thư mục chính của người dùng hiện tại
$dir
$path
echo -e :tùy chọn -e cho phép chèn các ký tự, như \n cho dòng mới hoặc \t cho các tab.

find / -type f -size +1G , find . -size +1G 
du -h * | grep -v "^\s*$" | sort -n | head -n 10
-> lọc file lớn hơn 1GB


find -atime -1 -type fclear -> lọc file truy cập từ 1 ngày trước 
find . -mtime +7 -> tìm tất cả các file đã không truy cập từ 1 tuần trước

scp remote_username@127.0.0.1:/remote/pavietnam.tar.gz /local/directory -> copy file từ máy remote
scp -i d-key-PRD-0001.PEM user@server:/sourcefile /desfile -> copy
scp -i d-key-PRD-0001.PEM /sourcefile user@server:/desfile -> đẩy

- Kiểm tra định dạng của sda3:
df -hT

- Sử dụng lệnh df -h để xác định kích thước hiện tại của sda3:
df -h

- Sử dụng lệnh fdisk /dev/sda để mở rộng kích thước của sda:
sudo fdisk /dev/sda
Nhấn p để liệt kê các phân vùng hiện có.
Nhấn d để xóa phân vùng sda3.
Nhấn n để tạo phân vùng mới.
Nhập p để tạo phân vùng chính.
Nhập kích thước phân vùng mới. 
Sử dụng lệnh resize2fs /dev/sda3 để tăng kích thước của sda3:
sudo resize2fs /dev/sda3

- lấy trường thứ 2 từ dữ liệu truyền vào bằng lệnh 
ls -l | awk -F ' ' '{print $5 " "}'

echo ${hostname:4:1}

stop chronyd: sudo systemctl stop chronyd
change time: sudo date -s "YYYY-MM-DD HH:MM:SS"


- tạo một tệp có tên myfile với dung lượng 100MB:
dd if=/dev/zero of=myfile bs=1M count=100

- SSH Tunneling
ssh -L 4000:10.103.1.19:3389 -i AP_windows_server.pem ubuntu@18.183.252.6

check ram: while true ; do echo $(date) >> /tmp/ram_log ; free |& tee -a /tmp/ram_log; sleep 1; done;
check cpu: watch -n 1 "mpstat -P ALL |$ tee -a /tmp/ddos_log"

dos2unix

# 1. Entry: Minute when the process will be started [0-60]
# 2. Entry: Hour when the process will be started [0-23]
# 3. Entry: Day of the month when the process will be started [1-28/29/30/31]
# 4. Entry: Month of the year when the process will be started [1-12]
# 5. Entry: Weekday when the process will be started [0-6] [0 is Sunday]


Cách Kiểm Tra Các Thư Viện (Lib) Đã Cài Đặt Trong Linux
dpkg -l
dpkg -s <tên_gói>
apt list --installed
rpm -qa

giải nén file:
tar -zxvf <tên_tệp_tar.gz>

nén file
tar -czvf <tên_file_nén.tar.gz> <các_file_hoặc_thư_mục>

Cách kiểm tra số lượng phiên SSH đang kết nối đến máy Linux
Để kiểm tra số lượng phiên SSH đang kết nối đến máy Linux, bạn có thể sử dụng một số lệnh sau:

1. Lệnh w:
Công dụng: Hiển thị thông tin về các người dùng đang đăng nhập và tiến trình họ đang chạy.
Cách sử dụng:

w

Kết quả: Lệnh này sẽ hiển thị một bảng thông tin, bao gồm tên người dùng, terminal, thời gian đăng nhập, thời gian không hoạt động và lệnh đang chạy. Bạn có thể đếm số dòng trong phần này để biết số lượng phiên SSH.
2. Lệnh who:
Công dụng: Hiển thị danh sách các người dùng đang đăng nhập vào hệ thống.
Cách sử dụng:

who


Kết quả: Lệnh này sẽ liệt kê tên người dùng, terminal và thời gian đăng nhập.
3. Lệnh ps aux | grep sshd:
Công dụng: Liệt kê tất cả các tiến trình đang chạy và lọc ra các tiến trình liên quan đến SSH.
Cách sử dụng:

ps aux | grep sshd

Kết quả: Lệnh này sẽ hiển thị danh sách các tiến trình có chứa từ khóa "sshd". Mỗi dòng đại diện cho một phiên SSH.
4. Lệnh netstat -antp | grep :22:
Công dụng: Hiển thị các kết nối mạng đang mở, bao gồm cả các kết nối SSH.
Cách sử dụng:

netstat -antp | grep :22


Kết quả: Lệnh này sẽ liệt kê các kết nối đang nghe trên cổng 22 (cổng mặc định của SSH). Mỗi dòng đại diện cho một kết nối SSH.
Lựa chọn lệnh phù hợp:
w và who cung cấp thông tin tổng quan về các người dùng đang đăng nhập.
ps aux | grep sshd cung cấp thông tin chi tiết hơn về các tiến trình SSH.
netstat -antp | grep :22 tập trung vào các kết nối mạng trên cổng SSH.
Lưu ý:

Số lượng phiên: Để đếm chính xác số lượng phiên, bạn có thể kết hợp các lệnh trên với lệnh wc -l (đếm số dòng). Ví dụ: ps aux | grep sshd | wc -l.
Các tùy chọn khác: Các lệnh trên có nhiều tùy chọn khác để lọc và định dạng kết quả. Tham khảo tài liệu của từng lệnh để biết thêm chi tiết.
Ví dụ:
Để kiểm tra số lượng phiên SSH đang kết nối và hiển thị thông tin chi tiết về các phiên đó, bạn có thể sử dụng lệnh:


ps aux | grep sshd


Kết quả có thể giống như sau:

user1     2345  0.0  0.0 11244  1284 pts/0    S+   11:34   0:00 sshd: user1@pts/0
user2     3456  0.1  0.2 15360  2560 pts/1    S+   12:00   0:01 sshd: user2@pts/1
Giải thích:

user1 và user2: Tên người dùng.
2345 và 3456: PID của tiến trình.
pts/0 và pts/1: Terminal mà người dùng kết nối.
11:34 và 12:00: Thời gian bắt đầu phiên.
Các lệnh khác có thể hữu ích:

last: Hiển thị lịch sử đăng nhập của các người dùng.
whois: Hiển thị thông tin về một tên miền hoặc địa chỉ IP.
Chú ý: Việc kiểm tra và quản lý các phiên SSH là rất quan trọng để đảm bảo bảo mật cho hệ thống của bạn. Bạn nên thường xuyên kiểm tra và cấu hình các dịch vụ SSH để ngăn chặn các cuộc tấn công từ bên ngoài.

★ tiến trình trong linux:
https://www.geeksforgeeks.org/pstree-command-in-linux-with-examples/ 

tìm ký tự abc ở các file tại đường dẫn /home
find /home -type f -exec grep -Hn "abc" {} \; 
grep "abc" *.*

Tìm file trong máy:
find / -name "*.ycc"
find . -name "abc"

Các phím tắt cơ bản trong lệnh vi của Linux
Hiểu về các chế độ của vi
Vi hoạt động dựa trên các chế độ khác nhau. Hai chế độ chính là:
	Chế độ lệnh (command mode): Đây là chế độ mặc định khi bạn mở vi. Trong chế độ này, các phím bạn gõ sẽ được hiểu là các lệnh để điều khiển vi, chứ không phải để nhập văn bản.
	Chế độ chèn (insert mode): Trong chế độ này, các phím bạn gõ sẽ được chèn trực tiếp vào văn bản.
Các phím tắt cơ bản
Chuyển đổi giữa các chế độ:
	Esc: Chuyển từ chế độ chèn về chế độ lệnh.
Di chuyển con trỏ:
	h: Di chuyển sang trái một ký tự.
	j: Di chuyển xuống một dòng.
	k: Di chuyển lên một dòng.
	l: Di chuyển sang phải một ký tự.
	w: Di chuyển đến đầu từ tiếp theo.
	b: Di chuyển đến đầu từ trước đó.
	0: Di chuyển đến đầu dòng.
	$: Di chuyển đến cuối dòng.
Chỉnh sửa văn bản:
	i: Chèn ký tự trước vị trí con trỏ (insert).
	a: Chèn ký tự sau vị trí con trỏ (append).
	o: Mở một dòng mới ở dưới dòng hiện tại.
	O: Mở một dòng mới ở trên dòng hiện tại.
	x: Xóa ký tự dưới con trỏ.
	dw: Xóa từ dưới con trỏ.
	dd: Xóa dòng hiện tại.
	yy: Sao chép dòng hiện tại.
	p: Dán dòng đã sao chép.
Lưu và thoát:
	:wq: Lưu thay đổi và thoát.
	:q!: Thoát mà không lưu.
Tìm kiếm:
	/pattern: Tìm kiếm từ đầu đến cuối tệp.
	?pattern: Tìm kiếm từ cuối lên đầu tệp.
Ví dụ
	Để chèn một dòng mới ở trên dòng hiện tại, nhấn O.
	Để xóa từ dưới con trỏ, nhấn dw.
	Để lưu và thoát, nhấn :wq.
Một số phím tắt nâng cao
	u: Hoàn tác (undo).
	ctrl+r: Lại làm (redo).
	. (chấm): Lặp lại lệnh trước đó.
	v: Chế độ visual để chọn khối văn bản.

It's a useful vi operation to know. I'll explain it at the next Meet. ★ is especially useful
↓ j
↑ k
:100 Jump to line 100 ★
:0 First
G Last line

/Request complete Search ★
n Search next
? Search previous
o Insert (previous line)
O Insert (next line)
A Insert at end of line
I Insert at beginning of line
yy ⇒ p Copy and paste line
dd ⇒ p Delete and paste line
cw Replace
. Repeat execution
u Edit Return
:%s/aaaa/bbbb/g Replace all
:%g/aaaa/d Delete all lines with aaaa

1.	Chọn các dòng cần copy: 
	Dùng số để chọn: 
	Để chọn 5 dòng bắt đầu từ dòng hiện tại, bạn gõ: 5yy (y là lệnh yank - tương đương với copy).
	Để chọn từ dòng hiện tại đến cuối file, bạn gõ: :.,$y
	Dùng dấu . để lặp lại lệnh: 
	Nếu vừa copy 5 dòng, muốn copy thêm 5 dòng nữa, chỉ cần gõ ..
2.	Dán các dòng đã copy: 
	Để dán các dòng đã copy vào dòng tiếp theo, gõ: p
	Để dán các dòng đã copy trước dòng hiện tại, gớ: P
Ví dụ:
•	Copy 3 dòng bắt đầu từ dòng hiện tại và dán vào cuối file:
	3yy
	G p
	3yy: Copy 3 dòng.
	G: Di chuyển con trỏ đến cuối file.
	p: Dán các dòng đã copy.
•	Copy từ dòng hiện tại đến cuối file và dán vào đầu file:
	:.,$y
	gg p
	:.,$y: Copy từ dòng hiện tại đến cuối file.
	gg: Di chuyển con trỏ đến đầu file.
	p: Dán các dòng đã copy.
Một số lệnh khác liên quan:
•	Xóa nhiều dòng: 
	dd: Xóa dòng hiện tại.
	3dd: Xóa 3 dòng bắt đầu từ dòng hiện tại.
•	Di chuyển nhiều dòng: 
	yy (copy) và p (paste) kết hợp để di chuyển các dòng.
•	Tìm kiếm và thay thế: 
	/tìm_kiếm: Tìm kiếm từ khóa.
	:s/tìm/thay_thế/g: Thay thế tất cả các từ tìm thấy trong file.

https://tel4vn.edu.vn/top-30-cau-lenh-thuong-su-dung-trong-devops/

- Đo cpu: sar -u 60 60

- kiểm tra các gói đã cài đặt:   apt list --installed
  dnf list installed

- ssh bằng mobaxterm:

sudo apt update
sudo apt install openssh-server
sudo yum install openssh-server
sudo systemctl start ssh
sudo service sshd start

sudo systemctl status ssh (to check status)
sudo systemctl start ssh (to start)
sudo systemctl enable ssh (to enable on boot)
Linux (ufw): sudo ufw allow 22
Linux (firewalld): sudo firewall-cmd --permanent --add-port=22/tcp && sudo firewall-cmd --reload

✅ Bước 1: Kiểm tra swap hiện tại

swapon --show
free -h
Nếu không thấy gì ở swapon --show → chưa có swap.

🧱 Bước 2: Tạo file swap (ví dụ: 2GB)

sudo fallocate -l 2G /swapfile
Nếu fallocate không hỗ trợ:

sudo dd if=/dev/zero of=/swapfile bs=1M count=2048

🔒 Bước 3: Cấp quyền đúng cho file

sudo chmod 600 /swapfile
⚙️ Bước 4: Biến file thành swap

sudo mkswap /swapfile
🚀 Bước 5: Kích hoạt swap

sudo swapon /swapfile
Kiểm tra lại:

swapon --show
🔁 Bước 6: Kích hoạt vĩnh viễn (sau reboot)
Thêm dòng sau vào cuối file /etc/fstab:

/swapfile none swap sw 0 0
sudo nano /etc/fstab

🎛️ Bước 7: (Tuỳ chọn) Tinh chỉnh hệ thống swap
Giảm độ ưu tiên dùng swap nếu bạn muốn dùng RAM tối đa trước:

sudo sysctl vm.swappiness=10
Mặc định là 60. Dùng 10 để hạn chế swap chỉ khi RAM thực sự thiếu.

Để đặt vĩnh viễn:

echo 'vm.swappiness=10' | sudo tee -a /etc/sysctl.conf

# sửa gateway:
nmcli con mod ens160 ipv4.gateway 192.168.102.2
nmcli con mod ens160 ipv4.method auto
nmcli con up ens160

#thông tin cấu hình mạng
nmcli con show

#kiểm tra cấu hình định tuyến
ip route

#thêm default route
sudo ip route add default via <gateway_IP>

#Kiểm tra firewalld, iptables
sudo systemctl status firewalld
sudo iptables -L -n

#restart mạng
sudo nmcli networking off
sudo nmcli networking on

#cấu hình ip 
# Gán IP tĩnh
sudo ip addr add 192.168.1.100/24 dev ens33

# Gán default gateway
sudo ip route add default via 192.168.1.1

# Gán DNS tạm thời
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf

# Đặt IP tĩnh, gateway, DNS
sudo nmcli con mod ens33 ipv4.addresses 192.168.1.100/24
sudo nmcli con mod ens33 ipv4.gateway 192.168.1.1
sudo nmcli con mod ens33 ipv4.dns "8.8.8.8 1.1.1.1"
sudo nmcli con mod ens33 ipv4.method manual

# Áp dụng thay đổi
sudo nmcli con up ens33

# Mở rộng phân vùng logic (LVM)
Các bước mở rộng phân vùng LVM:

Kiểm tra nhóm và phân vùng logic: Đầu tiên, kiểm tra kích thước của nhóm và phân vùng logic.
sudo vgdisplay
sudo lvdisplay

Mở rộng phân vùng logic: Nếu nhóm volume (ubuntu-vg) còn dung lượng trống, bạn có thể mở rộng phân vùng logic ubuntu-lv để sử dụng thêm dung lượng từ sda3. Ví dụ:
sudo lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv

Mở rộng hệ thống tệp: Sau khi mở rộng phân vùng, bạn cần phải thay đổi kích thước hệ thống tệp để nhận diện dung lượng mới:
sudo resize2fs /dev/ubuntu-vg/ubuntu-lv


- UBUNTU: 
✅ 1. DỌN /var: cache, logs, apt, docker
# Xoá cache apt
sudo apt clean
sudo apt autoclean

# Xoá log cũ
sudo journalctl --vacuum-time=7d
sudo rm -rf /var/log/*.gz /var/log/*.[0-9] /var/log/**/*.gz /var/log/**/*.[0-9]

# Xoá cache của systemd
sudo du -sh /var/lib/systemd/coredump
sudo rm -rf /var/lib/systemd/coredump/*

# Xoá Docker data (nếu không dùng nữa)
sudo docker system prune -a
✅ 2. DỌN /usr: gỡ phần mềm không cần thiết

# Xem app nặng nhất
dpkg-query -Wf '${Installed-Size}\t${Package}\n' | sort -n | tail -n 20 | less

# Gỡ một số app nếu không cần (ví dụ LibreOffice, Firefox)
sudo apt remove --purge libreoffice* firefox thunderbird

# Gỡ sạch mọi thứ không cần
sudo apt autoremove --purge
✅ 3. XÓA swap.img (nếu không dùng swap file)
⚠️ Chỉ làm nếu bạn hiểu rõ swap là gì và chắc chắn không cần.

sudo swapoff /swap.img
sudo rm /swap.img
sudo sed -i '/swap.img/d' /etc/fstab
✅ 4. DỌN /boot (nhiều kernel cũ)

# Xem kernel đang dùng
uname -r

# Liệt kê các kernel khác (không phải kernel hiện tại)
dpkg --list | grep linux-image

# Gỡ các kernel cũ
sudo apt remove --purge linux-image-5.x.x-xx-generic  # thay bằng tên kernel cũ
sudo update-grub
✅ 5. XÓA SNAP (nếu không dùng Snap apps)

# Xóa tất cả Snap
snap list | awk 'NR>1 {print $1}' | xargs -n1 sudo snap remove --purge
sudo apt purge snapd
sudo rm -rf ~/snap /snap /var/snap /var/lib/snapd
✅ 6. DỌN /tmp, /var/tmp

sudo rm -rf /tmp/*
sudo rm -rf /var/tmp/*

- ALMA LINUX
✅ 1. Xoá cache của DNF/YUM

sudo dnf clean all
sudo rm -rf /var/cache/dnf
✅ 2. Gỡ các package không còn cần

sudo dnf autoremove
✅ 3. Xoá log cũ và journal logs

sudo journalctl --vacuum-time=7d
sudo rm -rf /var/log/*.gz /var/log/*.[0-9] /var/log/**/*.gz /var/log/**/*.[0-9]
✅ 4. Xoá file tạm và cache khác

sudo rm -rf /tmp/*
sudo rm -rf /var/tmp/*
✅ 5. Xoá core dumps nếu có

sudo rm -rf /var/lib/systemd/coredump/*
✅ 6. Xoá Docker data (nếu có)

sudo docker system prune -a
✅ 7. Gỡ Snap (nếu có)

sudo dnf remove snapd -y
sudo rm -rf ~/snap /snap /var/snap /var/lib/snapd

🧩 Cách Nâng Cấp Database Trên Linux
🟢 1️⃣ Các nguyên tắc chung trước khi nâng cấp

Dù là MySQL, PostgreSQL, MariaDB, hay MongoDB — bạn luôn tuân thủ 5 bước chuẩn sau:

✅ Bước 1: Kiểm tra phiên bản hiện tại
mysql -V
# hoặc
psql --version
# hoặc
mongo --version

✅ Bước 2: Sao lưu toàn bộ dữ liệu

Không bao giờ nâng cấp DB mà chưa có bản backup!

Ví dụ backup MySQL:

mysqldump -u root -p --all-databases > backup_$(date +%F).sql


Backup PostgreSQL:

pg_dumpall -U postgres > backup_pg_$(date +%F).sql


Backup MongoDB:

mongodump --out /backup/mongo_$(date +%F)

✅ Bước 3: Kiểm tra tương thích (compatibility)

Đọc release notes của phiên bản mới.

Kiểm tra thay đổi về:

Cú pháp SQL / lệnh bị deprecated

Cấu trúc dữ liệu system table

Plugin, authentication method

Ví dụ:
MySQL 5.7 → 8.0 thay đổi default_authentication_plugin thành caching_sha2_password.

✅ Bước 4: Thử nâng cấp trên môi trường test

Dựng server clone hoặc container test.

Restore dữ liệu backup → kiểm tra truy vấn, ứng dụng.

Chạy các công cụ kiểm tra chính thức:

mysqlcheck -u root -p --all-databases
pg_upgrade --check

✅ Bước 5: Nâng cấp thực tế

Tùy distro (Ubuntu / CentOS / Amazon Linux) và loại DB, lệnh sẽ khác nhau.


🔵 2️⃣ Nâng cấp MySQL / MariaDB
🔹 Cách 1: Upgrade bằng package manager
🧰 Ubuntu/Debian:
sudo apt update
sudo apt install mysql-server


Sau khi cài, chạy script nâng cấp dữ liệu:

sudo mysql_upgrade -u root -p
sudo systemctl restart mysql

🧰 CentOS / RHEL:
sudo yum update mysql-server
sudo systemctl restart mysqld

🔹 Cách 2: Upgrade thủ công (nếu major version thay đổi)

Stop service:

sudo systemctl stop mysqld


Backup /var/lib/mysql

Gỡ bản cũ:

sudo yum remove mysql-server


Cài bản mới (từ repo chính thức):

sudo rpm -Uvh https://dev.mysql.com/get/mysql80-community-release-el7-7.noarch.rpm
sudo yum install mysql-server


Khởi động lại:

sudo systemctl start mysqld
sudo mysql_upgrade

🟠 3️⃣ Nâng cấp PostgreSQL
🔹 Kiểm tra phiên bản:
psql --version

🔹 Backup và stop service:
sudo systemctl stop postgresql
pg_dumpall -U postgres > backup_pg.sql

🔹 Cài bản mới song song (không ghi đè):
sudo apt install postgresql-15

🔹 Sử dụng công cụ pg_upgrade:
sudo -u postgres pg_upgrade \
  -b /usr/lib/postgresql/14/bin \
  -B /usr/lib/postgresql/15/bin \
  -d /var/lib/postgresql/14/main \
  -D /var/lib/postgresql/15/main

🔹 Cập nhật cấu hình & khởi động lại:
sudo systemctl start postgresql

🟣 4️⃣ Nâng cấp MongoDB

Stop service:
sudo systemctl stop mongod

Backup:
mongodump --out /backup/mongo_$(date +%F)

Update repo và gói:
sudo apt update
sudo apt install -y mongodb-org

Start lại:
sudo systemctl start mongod



Xác minh:
mongo --eval "db.version()"

1. Thay thế Chuỗi Đơn giảnThay thế lần xuất hiện đầu tiên của từ "localhost" thành "production" trong tệp config.txt:
sed 's/localhost/production/' config.txt

2. Thay thế Toàn cục trong Tệp (g flag)Thay thế tất cả các lần xuất hiện của từ "Error" thành "Notice" trên mọi dòng trong tệp, và chỉnh sửa trực tiếp tệp gốc:
sed -i 's/Error/Notice/g' application.log

3. Chỉ thay thế trên một số dòng cụ thể (Định vị Dòng)Sử dụng địa chỉ dòng (addressing) để giới hạn phạm vi thay thế:Cú phápÝ nghĩaVí dụ<số_dòng>s/...Chỉ thay thế trên dòng số <số_dòng>.sed '5s/user/admin/g' file.txt (Chỉ dòng 5)/<mẫu>/s/...Chỉ thay thế trên các dòng có chứa <mẫu>.sed '/config/s/false/true/g' setup.conf (Chỉ dòng chứa "config")<start>,<end>s/...Chỉ thay thế trong phạm vi từ dòng <start> đến <end>.sed '10,20s/old/new/g' data.csv (Từ dòng 10 đến 20)4. Xóa DòngSử dụng lệnh d (Delete) để xóa dòng:Xóa dòng có chứa một mẫu:Bashsed '/^#/d' script.sh  # Xóa tất cả các dòng bắt đầu bằng dấu # (comment)
Xóa dòng theo số thứ tự:
sed '5d' data.txt      # Xóa dòng thứ 5
sed '1,3d' data.txt    # Xóa từ dòng 1 đến dòng 3

5. Thêm/Chèn DòngSử dụng lệnh i (Insert) để chèn trước dòng được chỉ định, hoặc a (Append) để chèn sau dòng được chỉ định.Bash# Chèn một dòng mới trước dòng có chứa từ "BEGIN"
sed '/BEGIN/i\--- Dữ liệu mới đã được chèn ở đây ---' file.txt
